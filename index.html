<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ·Ø¨ÙŠÙ‚ ØªØµÙˆÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix"></script>
<style>
  body { transition: background 0.3s; }
  canvas { max-width: 100%; height: auto; border-radius: 10px; cursor: grab; }
</style>
</head>
<body class="bg-gray-100 text-center min-h-screen p-4">

<script>
  // Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„
  const password = "12300"; 
  let entered = prompt("ğŸ”’ Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹:");
  while (entered !== password) {
    if (entered === null) { alert("ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø±Ù…Ø²!"); window.close(); break; }
    entered = prompt("âŒ Ø§Ù„Ø±Ù…Ø² Ø®Ø§Ø·Ø¦ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰:");
  }
</script>

<h1 class="text-2xl font-bold mb-4 text-indigo-700">ğŸ“¸ ØªØ·Ø¨ÙŠÙ‚ ØªØµÙˆÙŠØ± ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</h1>

<!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
<input type="file" id="imageInput" accept="image/*" class="mb-4"/>
<button id="cameraBtn" class="bg-indigo-600 text-white px-4 py-2 rounded mb-4">ğŸ“· Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ø±Ø¶ -->
<div class="flex justify-center mb-4">
  <canvas id="canvas"></canvas>
</div>

<!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
<div class="flex flex-wrap justify-center gap-2 mb-4">
  <button id="removeBgBtn" class="bg-blue-600 text-white px-3 py-2 rounded">ğŸ§½ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©</button>
  <button id="colorBgBtn" class="bg-green-600 text-white px-3 py-2 rounded">ğŸ¨ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</button>
  <button id="generateBgBtn" class="bg-purple-600 text-white px-3 py-2 rounded">ğŸŒ„ ØªÙˆÙ„ÙŠØ¯ Ø®Ù„ÙÙŠØ© AI</button>
  <button id="enhanceBtn" class="bg-orange-600 text-white px-3 py-2 rounded">âœ¨ ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø©</button>
  <button id="addTextBtn" class="bg-pink-600 text-white px-3 py-2 rounded">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù†Øµ</button>
  <button id="resetBtn" class="bg-red-600 text-white px-3 py-2 rounded">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
  <button id="saveBtn" class="bg-gray-800 text-white px-3 py-2 rounded">ğŸ’¾ Ø­ÙØ¸</button>
</div>

<!-- ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø© -->
<div class="bg-white rounded-lg p-3 shadow-md max-w-md mx-auto mb-4">
  <label>ğŸŒ Ø§Ù„Ø³Ø·ÙˆØ¹</label>
  <input type="range" id="brightness" min="0.5" max="1.5" step="0.05" value="1" class="w-full">
  <label>ğŸŒˆ Ø§Ù„ØªØ´Ø¨Ø¹</label>
  <input type="range" id="saturation" min="0" max="2" step="0.05" value="1" class="w-full">
  <label>âš« Ø§Ù„ØªØ¨Ø§ÙŠÙ†</label>
  <input type="range" id="contrast" min="0.5" max="1.5" step="0.05" value="1" class="w-full">
  <label>ğŸŒ€ Ø§Ù„ÙˆØ¶ÙˆØ­</label>
  <input type="range" id="sharpness" min="0" max="2" step="0.1" value="0" class="w-full">
  <label>ğŸŒ«ï¸ Ø§Ù„Ø¶Ø¨Ø§Ø¨ÙŠØ©</label>
  <input type="range" id="blur" min="0" max="5" step="0.2" value="0" class="w-full">
</div>

<!-- Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ù„ØªØ­Ø¬ÙŠÙ… -->
<div class="mt-4 flex justify-center gap-3 mb-4 flex-wrap">
  <button id="rotateBtn" class="bg-indigo-500 text-white px-3 py-2 rounded">ğŸ” ØªØ¯ÙˆÙŠØ±</button>
  <button id="flipHBtn" class="bg-indigo-500 text-white px-3 py-2 rounded">â†”ï¸ Ù‚Ù„Ø¨ Ø£ÙÙ‚ÙŠ</button>
  <button id="flipVBtn" class="bg-indigo-500 text-white px-3 py-2 rounded">â†•ï¸ Ù‚Ù„Ø¨ Ø¹Ù…ÙˆØ¯ÙŠ</button>
  <label>ğŸ” ØªÙƒØ¨ÙŠØ±</label>
  <input type="range" id="scale" min="0.5" max="2" step="0.05" value="1">
</div>

<input type="color" id="colorPicker" hidden />

<script>
let originalImage = null;
let canvas = document.getElementById('canvas');
let ctx = canvas.getContext('2d');
let net;
let rotation=0, flipH=false, flipV=false, scale=1;
let currentBg = null;
let texts = [];

// ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ BodyPix
async function loadModel() {
  net = await bodyPix.load({ multiplier:0.5 });
  console.log("âœ… Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¬Ø§Ù‡Ø²");
}
loadModel();

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
document.getElementById('imageInput').addEventListener('change', e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>loadImage(reader.result);
  reader.readAsDataURL(file);
});

// Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
document.getElementById('cameraBtn').addEventListener('click', async ()=>{
  const video=document.createElement('video');
  video.autoplay=true; video.playsInline=true;
  document.body.appendChild(video);
  const stream=await navigator.mediaDevices.getUserMedia({video:true});
  video.srcObject=stream;
  await new Promise(res=>video.onloadedmetadata=res);

  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  ctx.drawImage(video,0,0);
  originalImage=new Image();
  originalImage.src=canvas.toDataURL();
  stream.getTracks().forEach(track=>track.stop());
  video.remove();
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
function loadImage(src){
  const img=new Image();
  img.onload=()=>{
    canvas.width=img.width;
    canvas.height=img.height;
    originalImage=img;
    resetTransform();
  }
  img.src=src;
}

// Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©
function resetTransform(){
  rotation=0; flipH=false; flipV=false; scale=1; currentBg=null; texts=[];
  if(originalImage){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(originalImage,0,0);
  }
}

// Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
document.getElementById('removeBgBtn').addEventListener('click', async ()=>{
  if(!originalImage) return alert("Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹!");
  const segmentation=await net.segmentPerson(originalImage,{internalResolution:'medium',segmentationThreshold:0.7});
  const imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
  for(let i=0;i<imgData.data.length;i+=4){
    const n=i/4;
    if(segmentation.data[n]===0) imgData.data[i+3]=0;
  }
  ctx.putImageData(imgData,0,0);
});

// Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©
document.getElementById('colorBgBtn').addEventListener('click',()=>document.getElementById('colorPicker').click());
document.getElementById('colorPicker').addEventListener('input', e=>{
  currentBg = e.target.value;
  redraw();
});

// ØªÙˆÙ„ÙŠØ¯ Ø®Ù„ÙÙŠØ© AI
const backgrounds=Array.from({length:120},(_,i)=>`https://picsum.photos/800/600?random=${i+1}`);
document.getElementById('generateBgBtn').addEventListener('click', ()=>{
  currentBg=new Image();
  currentBg.crossOrigin="anonymous";
  currentBg.onload=redraw;
  currentBg.src=backgrounds[Math.floor(Math.random()*backgrounds.length)];
});

// ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø©
document.getElementById('enhanceBtn').addEventListener('click', ()=>{
  if(!originalImage) return;
  ctx.filter='brightness(1.2) contrast(1.2) saturate(1.3)';
  redraw();
  ctx.filter='none';
});

// Ø¥Ø¶Ø§ÙØ© Ù†ØµÙˆØµ
document.getElementById('addTextBtn').addEventListener('click', ()=>{
  const txt=prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ:");
  if(txt) texts.push({text:txt,x:canvas.width/2,y:canvas.height/2,color:"#000",size:40});
  redraw();
});

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„ØªØ­Ø¬ÙŠÙ…
const applyFilters=()=>{
  if(!originalImage) return;
  const brightness=document.getElementById('brightness').value;
  const saturation=document.getElementById('saturation').value;
  const contrast=document.getElementById('contrast').value;
  const sharpness=document.getElementById('sharpness').value;
  const blur=document.getElementById('blur').value;
  scale=document.getElementById('scale').value;
  ctx.filter=`brightness(${brightness}) contrast(${contrast}) saturate(${saturation}) blur(${blur}px)`;
  redraw();
  ctx.filter='none';
};
['brightness','saturation','contrast','sharpness','blur','scale'].forEach(id=>{
  document.getElementById(id).addEventListener('input',applyFilters);
});

// ØªØ¯ÙˆÙŠØ± / Ù‚Ù„Ø¨
document.getElementById('rotateBtn').addEventListener('click',()=>{ rotation+=90; redraw(); });
document.getElementById('flipHBtn').addEventListener('click',()=>{ flipH=!flipH; redraw(); });
document.getElementById('flipVBtn').addEventListener('click',()=>{ flipV=!flipV; redraw(); });

// Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ù†ØµÙˆØµ
function redraw(){
  if(!originalImage) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
  if(currentBg){
    if(typeof currentBg==="string") ctx.fillStyle=currentBg, ctx.fillRect(0,0,canvas.width,canvas.height);
    else ctx.drawImage(currentBg,0,0,canvas.width,canvas.height);
  }

  // Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬
  const tempCanvas=document.createElement('canvas');
  tempCanvas.width=canvas.width; tempCanvas.height=canvas.height;
  const tCtx=tempCanvas.getContext('2d');
  tCtx.translate(canvas.width/2,canvas.height/2);
  tCtx.rotate(rotation*Math.PI/180);
  tCtx.scale(flipH?-1:1,flipV?-1:1);
  tCtx.scale(scale,scale);
  tCtx.drawImage(originalImage,-canvas.width/2,-canvas.height/2,canvas.width,canvas.height);
  ctx.drawImage(tempCanvas,0,0);

  // Ø±Ø³Ù… Ø§Ù„Ù†ØµÙˆØµ
  texts.forEach(t=>{
    ctx.fillStyle=t.color; ctx.font=`${t.size}px sans-serif`;
    ctx.textAlign='center'; ctx.fillText(t.text,t.x,t.y);
  });
}

// Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©
document.getElementById('saveBtn').addEventListener('click',()=>{
  const link=document.createElement('a');
  link.download='product_ai_photo.png';
  link.href=canvas.toDataURL('image/png');
  link.click();
});
</script>
</body>
</html>
